<!--
  This file is part of PanDrugs Backend.

  PanDrugs Backend is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  PanDrugs Backend is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with PanDrugs Backend.  If not, see <http://www.gnu.org/licenses/>.
-->

<div class="report">
    <button type="button" class="btn btn-default" data-target="#report"
        ng-click="$ctrl.showingReport = !$ctrl.showingReport" data-toggle="modal">See best candidates report</button>
    <div id="report" class="modal fade" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true"
                            ng-click="$ctrl.showingReport = false">&times;</span></button>
                    <button class="btn btn-primary" onclick="window.print()"><span
                            class="glyphicon glyphicon-print">&nbsp;</span>Print or save to PDF</button>
                </div>
                <div class="modal-body printable">
                    <div id="report-contents" ng-if="$ctrl.showingReport">
                        <div class="container-fluid">
                            <div class="row">
                                <img id="logo" src="images/pandrugs-logo.png">
                            </div>
                            <h2 class="row">PANDRUGS REPORT</h2>
                            <div class="row">
                                <p><strong>Disclaimer:</strong> This report is intended for research use only and should
                                    not be used for medical or professional advice.</p>
                            </div>
                            <div class="row" id="report-header-data">
                                <dl>
                                    <dt>ID:</dt>
                                    <dd>{{$ctrl.getComputation().name}}</dd>
                                    <dt>Date:</dt>
                                    <dd>{{$ctrl.date.toString()}}</dd>
                                    <dt>Analysis type:</dt>
                                    <dd>{{$ctrl.getAnalysisType()}}</dd>
                                </dl>
                            </div>
                            <div class="row">
                                <p>
                                    This report provides a summary and statistical overview of the results obtained from
                                    PanDrugs, as well as a complete list of the most promising drugs associated with the
                                    identified actionable variants and the supporting molecular evidence.
                                </p>
                            </div>
                            <h2 class="row">SUMMARY</h2>

                            <div class="row">
                                <div class="col-xs-6">
                                    <h3>DRUGS</h3>
                                    <dl>
                                        <dt># “Best Candidate” drugs:</dt>
                                        <dd><span
                                                class="count-value">{{$ctrl.bestCandidateGeneDrugGroups.length}}</span>
                                        </dd>
                                        <dt>Drug status:</dt>
                                        <dd>AP:
                                            <span
                                                class="count-value">{{$ctrl.bestCandidateGeneDrugGroups.statusCounts['APPROVED']
                                                || "0"}}</span>;
                                            CT:
                                            <span
                                                class="count-value">{{$ctrl.bestCandidateGeneDrugGroups.statusCounts['CLINICAL_TRIALS']
                                                || "0"}}</span>;
                                            EX:
                                            <span
                                                class="count-value">{{$ctrl.bestCandidateGeneDrugGroups.statusCounts['EXPERIMENTAL']
                                                || "0"}}</span>
                                        </dd>
                                        <dt>Drug type:</dt>
                                        <dd>
                                            <span
                                                ng-if="$ctrl.bestCandidateGeneDrugGroups.therapyTypeCounts['TARGETED_THERAPY']">TT:
                                                <span
                                                    class="count-value">{{$ctrl.bestCandidateGeneDrugGroups.therapyTypeCounts['TARGETED_THERAPY']}}</span>;</span>
                                            <span
                                                ng-if="$ctrl.bestCandidateGeneDrugGroups.therapyTypeCounts['CHEMOTHERAPY']">CTx:
                                                <span
                                                    class="count-value">{{$ctrl.bestCandidateGeneDrugGroups.therapyTypeCounts['CHEMOTHERAPY']}}</span>;</span>
                                            <span
                                                ng-if="$ctrl.bestCandidateGeneDrugGroups.therapyTypeCounts['COMBINATION_THERAPY']">CbT:
                                                <span
                                                    class="count-value">{{$ctrl.bestCandidateGeneDrugGroups.therapyTypeCounts['COMBINATION_THERAPY']}}</span>;</span>
                                            <span
                                                ng-if="$ctrl.bestCandidateGeneDrugGroups.therapyTypeCounts['IMMUNOTHERAPY']">IT:
                                                <span
                                                    class="count-value">{{$ctrl.bestCandidateGeneDrugGroups.therapyTypeCounts['IMMUNOTHERAPY']}}</span>;</span>
                                            <span
                                                ng-if="$ctrl.bestCandidateGeneDrugGroups.therapyTypeCounts['PHOTODYNAMIC_THERAPY']">PdT:
                                                <span
                                                    class="count-value">{{$ctrl.bestCandidateGeneDrugGroups.therapyTypeCounts['PHOTODYNAMIC_THERAPY']}}</span>;</span>
                                            <span
                                                ng-if="$ctrl.bestCandidateGeneDrugGroups.therapyTypeCounts['HORMONE_THERAPY']">HT:
                                                <span
                                                    class="count-value">{{$ctrl.bestCandidateGeneDrugGroups.therapyTypeCounts['HORMONE_THERAPY']}}</span>;</span>
                                            <span
                                                ng-if="$ctrl.bestCandidateGeneDrugGroups.therapyTypeCounts['OTHER']">other/NA:
                                                <span
                                                    class="count-value">{{$ctrl.bestCandidateGeneDrugGroups.therapyTypeCounts['OTHER']}}</span>;</span>

                                        </dd>
                                    </dl>

                                    <h3>Top-5 drug families:</h3>
                                    <ol>
                                        <li>[TT] PI3K inhibitors - 7 [AP: 5; CT: 1; EX: 1]</li>
                                        <li>2. [TT] EGFR inhibitors - 4 [AP: 1; CT: 2; EX: 1]</li>
                                        <li>3. [TT] BRAF inhibitors - 2 [AP: 2; CT: 0; EX: 0]</li>
                                        <li>4. [TT] MEK inhibitors - 2 [AP: 2; CT: 1; EX: 1]</li>
                                        <li>5. [CTx] Cellular process - 1 [AP: 1; CT: 0; EX: 0]</li>
                                    </ol>
                                </div>
                                <div class="col-xs-6">
                                    <h3>GENES</h3>
                                    <dl>
                                        <dt># genes:</dt>
                                        <dd>{{$ctrl.getQueriedGenesLength()}}</dd>
                                        <dt># genes in Pandrugs:</dt>
                                        <dd>{{$ctrl.genePresence.present.length}}</dd>
                                    </dl>
                                    <h3>ALL MOLECULAR EVIDENCES</h3>
                                    <dl>
                                        <dt># SNVs:</dt>
                                        <dd>143 - Missense: 25; NS: 2; Damaging: 9</dd>
                                        <dt ng-if="$ctrl.isMultiOmicsWithCNVAnalysis()"># CNVs:</dt>
                                        <dd ng-if="$ctrl.isMultiOmicsWithCNVAnalysis()">134 (Amp: 78; Del: 56)</dd>
                                        <dt># Exprs:
                                        <dd>67 up, 54 down</dd>
                                    </dl>
                                    <h3>BEST CANDIDATES</h3>
                                    <dl>
                                        <dt># SNVs:</dt>
                                        <dd>13 - Missense: 25; NS: 2; Damaging: 9</dd>
                                        <dt ng-if="$ctrl.isMultiOmicsWithCNVAnalysis()"># CNVs:</dt>
                                        <dd ng-if="$ctrl.isMultiOmicsWithCNVAnalysis()">14 (Amp: 8; Del: 4)</dd>
                                        <dt># Exprs:
                                        <dd>67 up, 54 down</dd>
                                    </dl>
                                </div>
                            </div>

                            <div class="row">
                                <p class="col">
                                    <strong>Legend:</strong> Drug status: Approved(AP), Clinical Trials(CT),
                                    Experimental(EX). Drug type: Targeted therapy (TT), Chemotherapy(CTx), Combination
                                    therapy (CbT), Hormone therapy (HT), Immunotherapy (IT), Photodynamic therapy (PdT),
                                    Other therapy (OT)
                                </p>
                            </div>



                            <h2 class="row">DRUG-GENE ASSOCIATIONS BEST CANDIDATES</h2>


                            <p>SUMMARY: PanDrugs suggest to treat (patient ID) with XXX based on xxxx alterations and
                                xxxx. The germline
                                alteration profile indicates xxxxx</p>

                            <p>Method: Patient's alterations (e.g. mutations, germinal variants, amplifications and
                                deletions) and gene
                                expression alterations are searched in PanDrugsDB and reported according to PanDrugs
                                scores (see GScore and
                                DScore), which combine clinico-biological gene relevance and susceptibility to
                                treatment, reflecting the
                                evidence level of the gene-drug association to the clinical evidence. </p>

                            <p>Table of results: In the following table, basic information of the patient´s alterations
                                with relevant clinical
                                implications can be found. Only the top best candidate drug-gene associations are
                                reported in this report. For a
                                detailed evaluation it is recommended to access the full PanDrugs analysis results.</p>

                            <p>Legend: Direct target (DT), Biomarker(BM), Pathway member (PM), Genetic Dependency (GD),
                                DrugScore (DS),
                                GeneScore (GS).</p>

                            <table id="best-candidates-table">

                                <thead>
                                    <tr>
                                        <td colspan="5">
                                            <p dir="ltr"><span>Drug&nbsp;</span></p>
                                        </td>
                                        <td colspan="4">&nbsp;<p dir="ltr"><span>Molecular evidences</span></p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td rowspan="2">&nbsp;<p dir="ltr"><span>Drug</span></p>
                                        </td>
                                        <td colspan="4">
                                            <p dir="ltr"><span>Status</span></p>
                                        </td>
                                        <td colspan="4">
                                            <p dir="ltr"><span>Gene (Variant, Alteration / Association)</span></p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="2">&nbsp;<p dir="ltr"><span>Type</span></p>
                                        </td>
                                        <td>&nbsp;<p dir="ltr"><span>Response</span></p>
                                        </td>
                                        <td>&nbsp;<p dir="ltr"><span>Family</span></p>
                                        </td>
                                        <td colspan="4">&nbsp;</td>
                                    </tr>
                                </thead>
                                <tbody ng-repeat="row in $ctrl.bestCandidateGeneDrugGroups">
                                    <tr>
                                        <td rowspan="2">&nbsp;<p dir="ltr"><span class="drug-name">{{row.showDrugName | titlecase}}</span></p>
                                        </td>
                                        <td colspan="4">
                                            <p ng-repeat="geneDrug in row.geneDrugs" dir="ltr"><span>{{geneDrug.drugStatusInfo}}</span></p>

                                            
                                        </td>
                                        <td colspan="4" rowspan="2">
                                            <p dir="ltr"><a
                                                    href="https://pubmed.ncbi.nlm.nih.gov/?term=%22VEMURAFENIB%22+%22BRAF%22"><span>BRAF</span></a><span>(p.V600E
                                                    / DT);&nbsp;</span></p>

                                            <p dir="ltr"><a
                                                    href="https://pubmed.ncbi.nlm.nih.gov/?term=%22VEMURAFENIB%22+%22MAP2K1%22"><span>MAP2K1</span></a><span>(p.V211D,
                                                </span><span>#Up</span><span> / BM);</span></p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="2">
                                            <p dir="ltr"><span>{{row.therapy | titlecase | replace:'_':' '}}</span></p>
                                        </td>
                                        <td>
                                            <p dir="ltr"><span>{{row.getSensitivity() | titlecase}}</span></p>
                                        </td>
                                        <td>
                                            <p dir="ltr"><span>{{row.family | enumeration}}</span></p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>